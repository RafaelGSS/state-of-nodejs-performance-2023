# Server Benchmark

Machine:

HTTP Benchmarking Tools:

* [autocannon](https://github.com/mcollina/autocannon)
* [wrk2](https://github.com/giltene/wrk2)

Node.js HTTP Servers:

* [fastify](https://github.com/fastify/fastify)
* [express](https://github.com/expressjs/express)

Route:

Return an `application/json` with `{ "hello": "world" }`.

## Results

### Node.js 16

Express

```console
ubuntu@ip-172-31-34-169:~/actions-runner$ npx autocannon -c 500 -d 120 -W [ -c 50 -d 5 ] http://localhost:3000
Running 5s warmup @ http://localhost:3000
50 connections

Running 120s test @ http://localhost:3000
500 connections


┌─────────┬───────┬───────┬───────┬───────┬──────────┬─────────┬────────┐
│ Stat    │ 2.5%  │ 50%   │ 97.5% │ 99%   │ Avg      │ Stdev   │ Max    │
├─────────┼───────┼───────┼───────┼───────┼──────────┼─────────┼────────┤
│ Latency │ 39 ms │ 42 ms │ 63 ms │ 65 ms │ 45.81 ms │ 8.09 ms │ 136 ms │
└─────────┴───────┴───────┴───────┴───────┴──────────┴─────────┴────────┘
┌───────────┬─────────┬─────────┬─────────┬─────────┬──────────┬────────┬─────────┐
│ Stat      │ 1%      │ 2.5%    │ 50%     │ 97.5%   │ Avg      │ Stdev  │ Min     │
├───────────┼─────────┼─────────┼─────────┼─────────┼──────────┼────────┼─────────┤
│ Req/Sec   │ 9287    │ 9455    │ 10895   │ 11807   │ 10800.02 │ 692.1  │ 7981    │
├───────────┼─────────┼─────────┼─────────┼─────────┼──────────┼────────┼─────────┤
│ Bytes/Sec │ 2.34 MB │ 2.38 MB │ 2.75 MB │ 2.98 MB │ 2.72 MB  │ 174 kB │ 2.01 MB │
└───────────┴─────────┴─────────┴─────────┴─────────┴──────────┴────────┴─────────┘

Req/Bytes counts sampled once per second.
# of samples: 120

1296k requests in 120.06s, 327 MB read
```

Fastify

```console
ubuntu@ip-172-31-34-169:~/actions-runner$ npx autocannon -c 500 -d 120 -W [ -c 50 -d 5 ] http://localhost:3000
Running 5s warmup @ http://localhost:3000
50 connections

Running 120s test @ http://localhost:3000
500 connections


┌─────────┬──────┬──────┬───────┬──────┬─────────┬─────────┬────────┐
│ Stat    │ 2.5% │ 50%  │ 97.5% │ 99%  │ Avg     │ Stdev   │ Max    │
├─────────┼──────┼──────┼───────┼──────┼─────────┼─────────┼────────┤
│ Latency │ 7 ms │ 8 ms │ 9 ms  │ 9 ms │ 8.02 ms │ 1.11 ms │ 110 ms │
└─────────┴──────┴──────┴───────┴──────┴─────────┴─────────┴────────┘
┌───────────┬─────────┬─────────┬─────────┬─────────┬──────────┬─────────┬─────────┐
│ Stat      │ 1%      │ 2.5%    │ 50%     │ 97.5%   │ Avg      │ Stdev   │ Min     │
├───────────┼─────────┼─────────┼─────────┼─────────┼──────────┼─────────┼─────────┤
│ Req/Sec   │ 57503   │ 57663   │ 59455   │ 59871   │ 59260.54 │ 1338.74 │ 45333   │
├───────────┼─────────┼─────────┼─────────┼─────────┼──────────┼─────────┼─────────┤
│ Bytes/Sec │ 10.8 MB │ 10.8 MB │ 11.2 MB │ 11.3 MB │ 11.1 MB  │ 251 kB  │ 8.52 MB │
└───────────┴─────────┴─────────┴─────────┴─────────┴──────────┴─────────┴─────────┘

Req/Bytes counts sampled once per second.
# of samples: 120

7112k requests in 120.05s, 1.34 GB read
```

### Node.js 18

Express:

```console
ubuntu@ip-172-31-34-169:~/actions-runner$ npx autocannon -c 500 -d 120 -W [ -c 50 -d 5 ] http://localhost:3000
Running 5s warmup @ http://localhost:3000
50 connections

Running 120s test @ http://localhost:3000
500 connections


┌─────────┬───────┬───────┬───────┬───────┬──────────┬─────────┬────────┐
│ Stat    │ 2.5%  │ 50%   │ 97.5% │ 99%   │ Avg      │ Stdev   │ Max    │
├─────────┼───────┼───────┼───────┼───────┼──────────┼─────────┼────────┤
│ Latency │ 40 ms │ 43 ms │ 64 ms │ 67 ms │ 47.78 ms │ 9.17 ms │ 172 ms │
└─────────┴───────┴───────┴───────┴───────┴──────────┴─────────┴────────┘
┌───────────┬─────────┬─────────┬─────────┬─────────┬──────────┬────────┬─────────┐
│ Stat      │ 1%      │ 2.5%    │ 50%     │ 97.5%   │ Avg      │ Stdev  │ Min     │
├───────────┼─────────┼─────────┼─────────┼─────────┼──────────┼────────┼─────────┤
│ Req/Sec   │ 7991    │ 8059    │ 10495   │ 11703   │ 10355.71 │ 917.23 │ 7883    │
├───────────┼─────────┼─────────┼─────────┼─────────┼──────────┼────────┼─────────┤
│ Bytes/Sec │ 2.01 MB │ 2.03 MB │ 2.65 MB │ 2.95 MB │ 2.61 MB  │ 231 kB │ 1.99 MB │
└───────────┴─────────┴─────────┴─────────┴─────────┴──────────┴────────┴─────────┘

Req/Bytes counts sampled once per second.
# of samples: 120

1243k requests in 120.05s, 313 MB read
```

Fastify

```console
ubuntu@ip-172-31-34-169:~/actions-runner$ npx autocannon -c 500 -d 120 -W [ -c 50 -d 5 ] http://localhost:3000
Running 5s warmup @ http://localhost:3000
50 connections

Running 120s test @ http://localhost:3000
500 connections


┌─────────┬──────┬──────┬───────┬───────┬─────────┬─────────┬────────┐
│ Stat    │ 2.5% │ 50%  │ 97.5% │ 99%   │ Avg     │ Stdev   │ Max    │
├─────────┼──────┼──────┼───────┼───────┼─────────┼─────────┼────────┤
│ Latency │ 7 ms │ 8 ms │ 9 ms  │ 10 ms │ 7.92 ms │ 1.17 ms │ 122 ms │
└─────────┴──────┴──────┴───────┴───────┴─────────┴─────────┴────────┘
┌───────────┬─────────┬─────────┬─────────┬─────────┬──────────┬─────────┬─────────┐
│ Stat      │ 1%      │ 2.5%    │ 50%     │ 97.5%   │ Avg      │ Stdev   │ Min     │
├───────────┼─────────┼─────────┼─────────┼─────────┼──────────┼─────────┼─────────┤
│ Req/Sec   │ 56415   │ 59103   │ 60767   │ 61599   │ 60580.27 │ 1099.76 │ 51107   │
├───────────┼─────────┼─────────┼─────────┼─────────┼──────────┼─────────┼─────────┤
│ Bytes/Sec │ 10.6 MB │ 11.1 MB │ 11.4 MB │ 11.6 MB │ 11.4 MB  │ 207 kB  │ 9.61 MB │
└───────────┴─────────┴─────────┴─────────┴─────────┴──────────┴─────────┴─────────┘

Req/Bytes counts sampled once per second.
# of samples: 120

7270k requests in 120.05s, 1.37 GB read
```

### Node.js 20

Express:

```console
ubuntu@ip-172-31-34-169:~/actions-runner$ npx autocannon -c 500 -d 120 -W [ -c 50 -d 5 ] http://localhost:3000
Running 5s warmup @ http://localhost:3000
50 connections

Running 120s test @ http://localhost:3000
500 connections


┌─────────┬───────┬───────┬───────┬───────┬──────────┬─────────┬────────┐
│ Stat    │ 2.5%  │ 50%   │ 97.5% │ 99%   │ Avg      │ Stdev   │ Max    │
├─────────┼───────┼───────┼───────┼───────┼──────────┼─────────┼────────┤
│ Latency │ 41 ms │ 43 ms │ 66 ms │ 68 ms │ 48.44 ms │ 9.07 ms │ 168 ms │
└─────────┴───────┴───────┴───────┴───────┴──────────┴─────────┴────────┘
┌───────────┬─────────┬─────────┬─────────┬─────────┬──────────┬────────┬─────────┐
│ Stat      │ 1%      │ 2.5%    │ 50%     │ 97.5%   │ Avg      │ Stdev  │ Min     │
├───────────┼─────────┼─────────┼─────────┼─────────┼──────────┼────────┼─────────┤
│ Req/Sec   │ 8083    │ 8187    │ 10351   │ 11263   │ 10213.82 │ 767.04 │ 7755    │
├───────────┼─────────┼─────────┼─────────┼─────────┼──────────┼────────┼─────────┤
│ Bytes/Sec │ 2.04 MB │ 2.06 MB │ 2.61 MB │ 2.84 MB │ 2.57 MB  │ 193 kB │ 1.95 MB │
└───────────┴─────────┴─────────┴─────────┴─────────┴──────────┴────────┴─────────┘

Req/Bytes counts sampled once per second.
# of samples: 120

1226k requests in 120.05s, 309 MB read
```

Fastify

```console
ubuntu@ip-172-31-34-169:~/actions-runner$ npx autocannon -c 500 -d 120 -W [ -c 50 -d 5 ] http://localhost:3000
Running 5s warmup @ http://localhost:3000
50 connections

Running 120s test @ http://localhost:3000
500 connections


┌─────────┬──────┬──────┬───────┬───────┬─────────┬─────────┬────────┐
│ Stat    │ 2.5% │ 50%  │ 97.5% │ 99%   │ Avg     │ Stdev   │ Max    │
├─────────┼──────┼──────┼───────┼───────┼─────────┼─────────┼────────┤
│ Latency │ 7 ms │ 8 ms │ 9 ms  │ 10 ms │ 7.98 ms │ 1.17 ms │ 129 ms │
└─────────┴──────┴──────┴───────┴───────┴─────────┴─────────┴────────┘
┌───────────┬─────────┬───────┬─────────┬─────────┬─────────┬─────────┬─────────┐
│ Stat      │ 1%      │ 2.5%  │ 50%     │ 97.5%   │ Avg     │ Stdev   │ Min     │
├───────────┼─────────┼───────┼─────────┼─────────┼─────────┼─────────┼─────────┤
│ Req/Sec   │ 57407   │ 58591 │ 60255   │ 60767   │ 60043.2 │ 1087.07 │ 49536   │
├───────────┼─────────┼───────┼─────────┼─────────┼─────────┼─────────┼─────────┤
│ Bytes/Sec │ 10.8 MB │ 11 MB │ 11.3 MB │ 11.4 MB │ 11.3 MB │ 205 kB  │ 9.31 MB │
└───────────┴─────────┴───────┴─────────┴─────────┴─────────┴─────────┴─────────┘

Req/Bytes counts sampled once per second.
# of samples: 120

7206k requests in 120.05s, 1.35 GB read
```
